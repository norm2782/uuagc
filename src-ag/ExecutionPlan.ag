imports
{
-- VisitSyntax.ag imports
import Patterns    (Pattern(..),Patterns)
import Expression  (Expression(..))
import CommonTypes

import qualified Data.Set as Set
import Data.Set(Set)
import qualified Data.Map as Map
import Data.Map(Map)
}

DATA ExecutionPlan | ExecutionPlan  nonts     : ENonterminals
     		     		    typeSyns  : {TypeSyns}
				    wrappers  : {Set NontermIdent}
				    derivings : {Derivings}

TYPE ENonterminals = [ENonterminal]

TYPE EProductions  = [EProduction]

TYPE ERules        = [ERule]

TYPE EChildren     = [EChild]

TYPE VisitSteps    = [VisitStep]

TYPE Visits        = [Visit]

DATA ENonterminal | ENonterminal nt         : {NontermIdent}
                                 params     : {[Identifier]}
				 initial    : {StateIdentifier}
				 initialv   : {Maybe VisitIdentifier}
				 nextVisits : {Map StateIdentifier WhatNext}  -- info about the next visits from a given state
                                 prods      : EProductions

DATA EProduction  | EProduction  con      : {ConstructorIdent}
     		   		 rules    : ERules
				 children : EChildren
				 visits   : Visits

DATA EChild       | EChild       name    : {Identifier}
                                 tp      : {Type}
             			 virtual : {Maybe (Maybe Type)}   -- first maybe: is child virtual, second maybe: did child already exist

DATA ERule        | ERule       name     : {Identifier}
                                pattern  : Pattern
                                rhs      : Expression
                                owrt     : {Bool}
                                origin   : String  -- just for documentation (and maybe errors)
                                explicit : Bool  -- True if this rule defined in the source code
                                pure     : Bool  -- True if this rule is pure (not monadic/no side effect)

DATA Visit        | Visit       ident    : {VisitIdentifier}
     		    		from     : {StateIdentifier}
				to       : {StateIdentifier}
				inh      : {Set Identifier}
				syn      : {Set Identifier}
     		    		steps    : VisitSteps

DATA VisitStep    | Sem         name     : {Identifier}
		  | ChildVisit  child    : {Identifier}
		    		nonterm  : {NontermIdent}
				visit    : {VisitIdentifier}
		  | Sim         steps    : VisitSteps
		  | ChildIntro  child    : {Identifier}
